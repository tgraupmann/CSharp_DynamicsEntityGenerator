# C# Dynamics 365 Entity Generator

This C# project that queries your Dynamics environment and uses the returned records to autogenerate early binding C# classes that can be easily saved/loaded to/from the CSV UTF8 format.

![image_1](images/image_1.png)

## Dependencies

* [CsvHelper](https://www.nuget.org/packages/CsvHelper/)

* [Microsoft.CrmSdk.XrmTooling.CoreAssembly](https://www.nuget.org/packages/Microsoft.CrmSdk.XrmTooling.CoreAssembly/)

## Quick Start

* Running as an Application User:

Edit `Secrets.cs` to use your own environment and secrets.

```
namespace DynamicsEntityGenerator
{
    class Secrets
    {
        public const string ServiceUrl = "";
        public const string ClientId = "";
        public const string Secret = ""; //secret value
        public const string Tenant = "";
    }
}
```

This mode uses the following `ConnectionString` format.

```
string connectionString = string.Format("AuthType=ClientSecret;Url={0};ClientId={1};ClientSecret={2}",
                Secrets.ServiceUrl,
                Secrets.ClientId,
                Secrets.Secret);
```

* Authenticate the service client with OAuth2.

```
IOrganizationService oServiceProxy = null;
try
{

    //Create the Dynamics 365 Connection:
    CrmServiceClient oMSCRMConn = new Microsoft.Xrm.Tooling.Connector.CrmServiceClient(connectionString);

    //Create the IOrganizationService:
    oServiceProxy = (IOrganizationService)oMSCRMConn.OrganizationWebProxyClient != null ? (IOrganizationService)oMSCRMConn.OrganizationWebProxyClient : (IOrganizationService)oMSCRMConn.OrganizationServiceProxy;
}
catch (Exception ex)
{
    Console.Error.WriteLine("Failed to initialize connection! {0}", ex);
}
```

## API

* Use the `OrganizationWebProxyClient` proxy to create a `AutoGeneratorClient` object to auto generate code.

```
AutoGeneratorClient client = new AutoGeneratorClient(oServiceProxy);
```

* Autogenerate C# classes in a datapath from queries given a list of entities.

```
string dataPath = "..\\..\\Autogenerated";

string[] entities =
{
    "account",
    "contact",
    "systemuser",
    "task",
};

client.GenerateClasses(dataPath, entities);
```

* Query all entity records and easily save to CSV files.

```
client.QueryDatabaseToCSV<Account>(Path.Combine(dataPath, "Accounts.csv"));
client.QueryDatabaseToCSV<Contact>(Path.Combine(dataPath, "Contact.csv"));
client.QueryDatabaseToCSV<Systemuser>(Path.Combine(dataPath, "User.csv"));
client.QueryDatabaseToCSV<Task>(Path.Combine(dataPath, "Task.csv"));
```
